"use strict";function groupDataByYear(){var a={};return $.each(pubdb,function(b,c){void 0===a[c.year]&&(a[c.year]=[]),a[c.year].push(c)}),$.each(a,function(b,c){var d=[],e={};$.each(c,function(a,b){b.authors.length>1&&$.each(b.authors,function(a,c){d.push(c.name),void 0===e[c.name]?e[c.name]={collaborations:b.authors.length-1,url:c.url}:e[c.name].collaborations+=b.authors.length-1})});var f=[],g={};$.each(d,function(a,b){-1===$.inArray(b,f)?(f.push(b),g[b]={publications:1,collaborations:e[b].collaborations,url:e[b].url}):g[b].publications++}),a[b].peoplePerYear=f,a[b].stats=g}),a}function drawDiagram(a,b,c,d){function e(a){return r(a.source.index)}function f(a){return function(b,c){o.selectAll(".chord path").filter(function(b){return(document.getElementById(b.source.index).id==c||document.getElementById(b.target.index).id==c)&&(document.getElementById(b.source.index).nextSibling.firstChild.style.opacity=Math.abs(a-1),document.getElementById(b.target.index).nextSibling.firstChild.style.opacity=Math.abs(a-1),document.getElementById(b.source.index).nextSibling.firstChild.nextSibling.style.opacity=Math.abs(a-1),document.getElementById(b.target.index).nextSibling.firstChild.nextSibling.style.opacity=Math.abs(a-1)),null}),o.selectAll(".chord path").filter(function(a){return a.source.index!==c&&a.target.index!==c}).transition().style("opacity",a)}}function g(a,b){var c=f(.1);c(a,b)}function h(a){u++;var c=(a.endAngle-a.startAngle)/a.value;return d3.range(0,1,1).map(function(d){return{angle:d*c+a.startAngle+(a.endAngle-a.startAngle)/2,label:b[u]}})}var i=d3.tip().attr("class","d3-tip").attr("id","d3tooltip").html(function(a){$("#d3tooltip").css("background-color",r(a.index));var d=b[a.index],e=void 0===c[d].url?"":'<strong>Website: </strong><a href="'+c[d].url+' ">'+c[d].url+"</a>",f="<strong>Author: </strong><span>"+d+"</span></br><strong>Publications: </strong><span>"+c[d].publications+"</span></br><strong>Collaborations: </strong><span>"+c[d].collaborations+"</span></br>"+e;return f}).offset([0,0]),j=$(".jumbotron").width(),k=j,l=j,m=.31*l,n=1.1*m,o=d3.select("#viz").append("svg").attr("width",k).attr("height",l).append("g").attr("transform","translate("+k/2+","+l/2+")");$(document).click(function(a){i.hide(a)}),o.call(i);var p,q=d3.layout.chord().matrix(a).sortSubgroups(d3.descending),r=d3.scale.category20c(),s=o.selectAll("g.group").data(q.groups).enter().append("svg:g").attr("class","group").on("click",function(a){a!==p?(d3.select(".d3-tip").transition().delay(10).duration(200).style("opacity",1),p=a,i.show(a)):p=null}),t=d3.svg.arc().innerRadius(m).outerRadius(n);s.append("path").attr("d",t).style("fill",function(a){return r(a.index)}).style("stroke",function(a){return r(a.index)}).attr("id",function(a){return a.index}),o.append("g").attr("class","chord").selectAll("path").data(q.chords).enter().append("path").attr("d",d3.svg.chord().radius(m)).style("fill",e).style("opacity",1),s.on("mouseover",g).on("mouseout",f(1));var u=-1,v=s.selectAll("g").data(h).enter().append("g").attr("transform",function(a){return"rotate("+(180*a.angle/Math.PI-90)+")translate("+n+",0)"});v.append("text").attr("dx",8).attr("dy",0).attr("opacity",0).attr("transform",function(a){return a.angle>Math.PI?"rotate(180)translate(-16, 0)":null}).style("text-anchor",function(a){return a.angle>Math.PI?"end":null}).text(function(a){return isNaN(a.angle)?null:a.label}),v.append("svg:line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).attr("opacity",0).attr("stroke","#000"),d()}function redrawDiagramWithFilter(a){$("#error").hide(),void 0===a&&$("#viz").height(viz),d3.select("#d3tooltip").remove(),d3.select("#viz svg").remove(),$("#fa-spinner").show();var b=yearSlider.slider("getValue"),c=pubSlider.slider("getValue"),d=collabSlider.slider("getValue"),e=getStatisticsForYear(dataByYear[b],c,d),f=!0;$.each(e,function(a,b){return f?void $.each(b,function(a,b){return 0!==b?(f=!1,!1):void 0}):!1}),f?$("#error").show():drawDiagram(e,names,dataByYear[b].stats,function(){$("#fa-spinner").hide(),viz=$("#viz").height()})}function newFilledArray(a,b){for(var c=new Array(a);--a>=0;)c[a]=b;return c}function getStatisticsForYear(a,b,c){for(var d=[],e=0;e<a.peoplePerYear.length;e++)d[e]=newFilledArray(a.peoplePerYear.length,0);return names=new Array(a.peoplePerYear.length),$.each(a,function(e,f){$.each(f.authors,function(e,g){for(var h=e+1;h<f.authors.length;h++){var i=$.inArray(g.name,a.peoplePerYear),j=$.inArray(f.authors[h].name,a.peoplePerYear),k=g.name,l=f.authors[h].name,m=a.stats[k].publications,n=a.stats[l].publications,o=a.stats[k].collaborations,p=a.stats[l].collaborations;m>=b&&n>=n&&o>=c&&p>=c&&(d[i][j]++,d[j][i]++,void 0===names[i]&&(names[i]=k),void 0===names[j]&&(names[j]=l))}})}),d}function redraw(){redrawDiagramWithFilter()}var names,dataByYear,viz;$(document).ready(function(){dataByYear=groupDataByYear(),redrawDiagramWithFilter(),$('[data-toggle="popover"]').popover()});var yearSlider=$("#yearFilter").slider({}),pubSlider=$("#pubFilter").slider({}),collabSlider=$("#collabFilter").slider({});yearSlider.on("slide",redraw),pubSlider.on("slide",redraw),collabSlider.on("slide",redraw),$("#redraw").click(redraw),$("#about").click(function(){$("#viz").hide(),$("#home").removeClass("active"),$("#about").addClass("active"),$("#filterRow").hide(),$("#aboutText").show()}),$("#home").click(function(){$("#aboutText").hide(),$("#viz").show(),$("#filterRow").show(),$("#about").removeClass("active"),$("#home").addClass("active")}),$(window).resize(function(){redrawDiagramWithFilter(!0)});