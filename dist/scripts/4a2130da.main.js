"use strict";function groupDataByYear(){var a={};return $.each(pubdb,function(b,c){void 0===a[c.year]&&(a[c.year]=[]),a[c.year].push(c)}),$.each(a,function(b,c){var d=[];$.each(c,function(a,b){b.authors.length>1&&$.each(b.authors,function(a,b){d.push(b.name)})});var e=[],f={};$.each(d,function(a,b){-1===$.inArray(b,e)?(e.push(b),f[b]={publications:1,collaborations:1}):(f[b].publications++,f[b].collaborations++)}),a[b].peoplePerYear=e,a[b].stats=f}),a}function drawDiagram(a,b,c){function d(a){return o(a.source.index)}function e(a){return function(b,c){m.selectAll(".chord path").filter(function(b){return(document.getElementById(b.source.index).id==c||document.getElementById(b.target.index).id==c)&&(document.getElementById(b.source.index).nextSibling.firstChild.style.opacity=Math.abs(a-1),document.getElementById(b.target.index).nextSibling.firstChild.style.opacity=Math.abs(a-1),document.getElementById(b.source.index).nextSibling.firstChild.nextSibling.style.opacity=Math.abs(a-1),document.getElementById(b.target.index).nextSibling.firstChild.nextSibling.style.opacity=Math.abs(a-1)),null}),m.selectAll(".chord path").filter(function(a){return a.source.index!==c&&a.target.index!==c}).transition().style("opacity",a)}}function f(a,b){var c=e(.1);c(a,b)}function g(a){r++;var c=(a.endAngle-a.startAngle)/a.value;return d3.range(0,1,1).map(function(d){return{angle:d*c+a.startAngle+(a.endAngle-a.startAngle)/2,label:b[r]}})}var h=$(".jumbotron").width(),i=h,j=h,k=.31*j,l=1.1*k,m=d3.select("#viz").append("svg").attr("width",i).attr("height",j).append("g").attr("transform","translate("+i/2+","+j/2+")"),n=d3.layout.chord().matrix(a).sortSubgroups(d3.descending),o=d3.scale.category20c(),p=m.selectAll("g.group").data(n.groups).enter().append("svg:g").attr("class","group"),q=d3.svg.arc().innerRadius(k).outerRadius(l);p.append("path").attr("d",q).style("fill",function(a){return o(a.index)}).style("stroke",function(a){return o(a.index)}).attr("id",function(a){return a.index}),m.append("g").attr("class","chord").selectAll("path").data(n.chords).enter().append("path").attr("d",d3.svg.chord().radius(k)).style("fill",d).style("opacity",1),p.on("mouseover",f).on("mouseout",e(1));var r=-1,s=p.selectAll("g").data(g).enter().append("g").attr("transform",function(a){return"rotate("+(180*a.angle/Math.PI-90)+")translate("+l+",0)"});s.append("text").attr("dx",8).attr("dy",0).attr("opacity",0).attr("transform",function(a){return a.angle>Math.PI?"rotate(180)translate(-16, 0)":null}).style("text-anchor",function(a){return a.angle>Math.PI?"end":null}).text(function(a){return isNaN(a.angle)?null:a.label}),s.append("svg:line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).attr("opacity",0).attr("stroke","#000"),c()}function redrawDiagramWithFilter(a){void 0===a&&$("#viz").height(viz),d3.select("#viz svg").remove(),$("#fa-spinner").show();var b=yearSlider.slider("getValue"),c=pubSlider.slider("getValue"),d=collabSlider.slider("getValue"),e=getStatisticsForYear(dataByYear[b],c,d);drawDiagram(e,names,function(){$("#fa-spinner").hide(),viz=$("#viz").height()})}function newFilledArray(a,b){for(var c=new Array(a);--a>=0;)c[a]=b;return c}function getStatisticsForYear(a,b,c){for(var d=[],e=0;e<a.peoplePerYear.length;e++)d[e]=newFilledArray(a.peoplePerYear.length,0);return names=new Array(a.peoplePerYear.length),$.each(a,function(e,f){$.each(f.authors,function(e,g){for(var h=e+1;h<f.authors.length;h++){var i=$.inArray(g.name,a.peoplePerYear),j=$.inArray(f.authors[h].name,a.peoplePerYear),k=g.name,l=f.authors[h].name,m=a.stats[k].publications,n=a.stats[l].publications,o=a.stats[k].collaborations,p=a.stats[l].collaborations;m>=b&&n>=n&&o>=c&&p>=c&&(d[i][j]++,d[j][i]++,void 0===names[i]&&(names[i]=k),void 0===names[j]&&(names[j]=l))}})}),d}function redraw(){redrawDiagramWithFilter()}var names,dataByYear,viz;$(document).ready(function(){dataByYear=groupDataByYear(),redrawDiagramWithFilter()}),$(function(){$('[data-toggle="popover"]').popover()});var yearSlider=$("#yearFilter").slider({}),pubSlider=$("#pubFilter").slider({}),collabSlider=$("#collabFilter").slider({});yearSlider.on("slide",redraw),pubSlider.on("slide",redraw),collabSlider.on("slide",redraw),$("#redraw").on("click",redraw),$(window).resize(function(){redrawDiagramWithFilter(!0)});